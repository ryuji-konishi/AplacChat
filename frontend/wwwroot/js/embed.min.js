var urlChatInferAddress,init=function(n,t,i,r){urlChatInferAddress=n;var u=t.find("#chat-input");u.keypress(function(n){var f=n.keyCode?n.keyCode:n.which,e;if(f!=8&&(!(33<=f)||!(f<=40))){e=u.val();switch(f){case 13:n.preventDefault();submitChat(t,i,r)}}});u.focus()},initLayout=function(n,t,i){var u=n.height(),f=t.height(),r=u-f;i.height(r);i.css("max-height",r)},submitChat=function(n,t,i){var u=n.find("#chat-input"),r=u.val();(r=r.trim(),r!="")&&(appendChatSend(t,i,r),showBusyImage(n),$.ajax({url:urlChatInferAddress,type:"POST",dataType:"json",contentType:"text/plain",data:r,success:function(r){r!=null?(hideMessage(n),u.val(""),appendChatReceive(t,i,r)):showMessage(n,"<strong>Sorry!<\/strong> Internal error happened.");hideBusyImage(n)},error:function(){showMessage(n,"<strong>Sorry!<\/strong> Internal error happened.");hideBusyImage(n)}}))},appendChatSend=function(n,t,i){appendChatText(n,t,i,"chat-send-record","chat-send-decorate")},appendChatReceive=function(n,t,i){appendChatText(n,t,i,"chat-receive-record","chat-receive-decorate")},appendChatText=function(n,t,i,r,u){var o=t.html(),e='<div class="'+u+'">',f;e+=i;e+="<\/div>";f='<div class="'+r+'">';f+=e;f+="<\/div>";t.html(o+f);n.scrollTop(Number.MAX_SAFE_INTEGER)},showMessage=function(n,t){n.find("#show-message").show().html("<p><b>"+t+"<\/b><\/p>")},hideMessage=function(n){n.find("#show-message").hide()},showBusyImage=function(n){n.find("#chat-input").addClass("chat-input-busy")},hideBusyImage=function(n){n.find("#chat-input").removeClass("chat-input-busy")};