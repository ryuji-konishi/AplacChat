var strAntiForgeryToken,strSubmitChatURL,init=function(n,t,i,r,u){strAntiForgeryToken=n;strSubmitChatURL=t;var f=i.find("#chat-input");f.keypress(function(n){var t=n.keyCode?n.keyCode:n.which,e;if(t!=8&&(!(33<=t)||!(t<=40))){e=f.val();switch(t){case 13:n.preventDefault();submitChat(i,r,u)}}});f.focus()},initLayout=function(n,t,i){var u=n.height(),f=t.height(),r=u-f;i.height(r);i.css("max-height",r)},submitChat=function(n,t,i){var u=n.find("#chat-input"),r=u.val();(r=r.trim(),r!="")&&(appendChatSend(t,i,r),showBusyImage(n),$.ajax({url:strSubmitChatURL,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",strAntiForgeryToken)},type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({text:r}),success:function(r){r!=null?(hideMessage(n),u.val(""),appendChatReceive(t,i,r)):showMessage(n,"<strong>Sorry!<\/strong> Internal error happened.");hideBusyImage(n)},error:function(){showMessage(n,"<strong>Sorry!<\/strong> Internal error happened.");hideBusyImage(n)}}))},appendChatSend=function(n,t,i){appendChatText(n,t,i,"chat-send-record","chat-send-decorate")},appendChatReceive=function(n,t,i){appendChatText(n,t,i,"chat-receive-record","chat-receive-decorate")},appendChatText=function(n,t,i,r,u){var o=t.html(),e='<div class="'+u+'">',f;e+=i;e+="<\/div>";f='<div class="'+r+'">';f+=e;f+="<\/div>";t.html(o+f);n.scrollTop(n.prop("scrollHeight")-n.height())},showMessage=function(n,t){n.find("#show-message").show().html("<p><b>"+t+"<\/b><\/p>")},hideMessage=function(n){n.find("#show-message").hide()},showBusyImage=function(n){n.find("#chat-input").addClass("chat-input-busy")},hideBusyImage=function(n){n.find("#chat-input").removeClass("chat-input-busy")};